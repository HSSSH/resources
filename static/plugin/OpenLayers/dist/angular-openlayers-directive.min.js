!function(e,t){if("function"==typeof require&&"object"==typeof exports){var r=require("openlayers");exports.angularOpenlayersDirective=t(r)}else"function"==typeof define&&define.amd?define(["openLayers","pOl3","angularSanitize","colorPicker"],function(r,o){return e.angularOpenlayersDirective=t(r,o)}):e.angularOpenlayersDirective=t(e.ol,e.P)}(this,function(e,t){angular.module("openlayers-directive",["ngSanitize"]).directive("openlayers",["$log","$q","$compile","olHelpers","olMapDefaults","olData",function(t,r,o,a,n,i){return{restrict:"EA",transclude:!0,replace:!0,scope:{center:"=olCenter",defaults:"=olDefaults",view:"=olView",events:"=olEvents"},template:'<div class="angular-openlayers-map" ng-transclude></div>',controller:["$scope",function(e){var t=r.defer();e.getMap=function(){return t.promise},e.setMap=function(e){t.resolve(e)},this.getOpenlayersScope=function(){return e}}],link:function(t,r,o){var l=a.isDefined,s=a.createLayer,c=a.setMapEvents,u=a.setViewEvents,p=a.createView,d=n.setDefaults(t);l(o.width)&&(isNaN(o.width)?r.css("width",o.width):r.css("width",o.width+"px")),l(o.height)&&(isNaN(o.height)?r.css("height",o.height):r.css("height",o.height+"px")),l(o.lat)&&(d.center.lat=parseFloat(o.lat)),l(o.lon)&&(d.center.lon=parseFloat(o.lon)),l(o.zoom)&&(d.center.zoom=parseFloat(o.zoom));var g=e.control.defaults(d.controls),f=e.interaction.defaults(d.interactions),y=p(d.view),v=new e.Map({target:r[0],controls:g,interactions:f,renderer:d.renderer,view:y,loadTilesWhileAnimating:d.loadTilesWhileAnimating,loadTilesWhileInteracting:d.loadTilesWhileInteracting});if(t.$on("$destroy",function(){i.resetMap(o.id)}),!o.customLayers){var m={type:"Tile",source:{type:"OSM"}},h=s(m,y.getProjection(),"default");v.addLayer(h),v.set("default",!0)}if(!l(o.olCenter)){var w=e.proj.transform([d.center.lon,d.center.lat],d.center.projection,y.getProjection());y.setCenter(w),y.setZoom(d.center.zoom)}c(d.events,v,t),u(d.events,v,t),t.setMap(v),i.setMap(v,o.id)}}}]),angular.module("openlayers-directive").directive("olCenter",["$log","$location","olMapDefaults","olHelpers",function(t,r,o,a){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(n,i,l,s){var c=a.safeApply,u=a.isValidCenter,p=a.isDefined,d=a.isArray,g=a.isNumber,f=a.isSameCenterOnMap,y=a.setCenter,v=a.setZoom,m=s.getOpenlayersScope();m.getMap().then(function(n){var i=o.getDefaults(m),s=n.getView(),h=m.center;if(l.olCenter.search("-")!==-1)return t.error('[AngularJS - Openlayers] The "center" variable can\'t use a "-" on his key name: "'+l.center+'".'),void y(s,i.view.projection,i.center,n);p(h)||(h={}),u(h)||(t.warn("[AngularJS - Openlayers] invalid 'center'"),h.lat=i.center.lat,h.lon=i.center.lon,h.zoom=i.center.zoom,h.projection=i.center.projection),h.projection||("pixel"!==i.view.projection?h.projection=i.center.projection:h.projection="pixel"),g(h.zoom)||(h.zoom=1),y(s,i.view.projection,h,n),s.setZoom(h.zoom);var w;if(h.centerUrlHash===!0){var S=function(){var e,t=r.search();if(p(t.c)){var o=t.c.split(":");3===o.length&&(e={lat:parseFloat(o[0]),lon:parseFloat(o[1]),zoom:parseInt(o[2],10)})}return e};w=S(),m.$on("$locationChangeSuccess",function(){var e=S();e&&!f(e,n)&&c(m,function(t){t.center.lat=e.lat,t.center.lon=e.lon,t.center.zoom=e.zoom})})}var b;m.$watchCollection("center",function(r){if(r){if(r.projection||(r.projection=i.center.projection),r.autodiscover)return b||(b=new e.Geolocation({projection:e.proj.get(r.projection)}),b.on("change",function(){if(r.autodiscover){var e=b.getPosition();c(m,function(t){t.center.lat=e[1],t.center.lon=e[0],t.center.zoom=12,t.center.autodiscover=!1,b.setTracking(!1)})}})),void b.setTracking(!0);u(r)||(t.warn("[AngularJS - Openlayers] invalid 'center'"),r=i.center);var o=s.getCenter();if(o)if("pixel"===i.view.projection||"pixel"===r.projection)s.setCenter(r.coord);else{var a=e.proj.transform(o,i.view.projection,r.projection);a[1]===r.lat&&a[0]===r.lon||y(s,i.view.projection,r,n)}s.getZoom()!==r.zoom&&v(s,r.zoom,n)}});var k=n.on("moveend",function(){c(m,function(t){if(p(t.center)){var o=n.getView().getCenter();if(t.center.zoom=s.getZoom(),"pixel"===i.view.projection||"pixel"===t.center.projection)return void(t.center.coord=o);if(t.center){var l=e.proj.transform(o,i.view.projection,t.center.projection);if(t.center.lat=l[1],t.center.lon=l[0],a.notifyCenterUrlHashChanged(m,t.center,r.search()),d(t.center.bounds)){var c=s.calculateExtent(n.getSize()),u=t.center.projection,g=i.view.projection;t.center.bounds=e.proj.transformExtent(c,g,u)}}}})});m.$on("$destroy",function(){e.Observable.unByKey(k)})})}}}]),angular.module("openlayers-directive").directive("olCluster",["$log","$q","olMapDefaults","olHelpers",function(t,r,o,a){return{restrict:"E",scope:{points:"=points",style:"=olStyle"},require:"^openlayers",link:function(t,r,o,n){var i=a.isDefined,l=n.getOpenlayersScope(),s=a.createStyle,c=a.createFeature;l.getMap().then(function(n){var l=a.createClusterLayer(o.zindex||0,o.distance);l.set("cluster",!0),n.addLayer(l);var u=o.callbackEvent,p=new e.style.AtlasManager({initialSize:512});t.style&&t.style.image.circle&&(t.style.image.circle.atlasManager={initialSize:512});var d=s(t.style),g=new e.style.Style({image:new e.style.Circle({radius:10,stroke:new e.style.Stroke({color:"#fff"}),fill:new e.style.Fill({color:"#3399CC"}),atlasManager:p}),text:new e.style.Text({text:"",fill:new e.style.Fill({color:"#fff"})})}),f=d.clone(),y=d.clone(),v=function(e){var t,r=e.get("features").length;if(r>1)u&&e.set("multiFeatureEvent",u),t=f,t&&t.getText()&&t.getText().setText(r.toString());else{var o=e.get("features")[0].get("pointStyle");t=angular.isDefined(o)?s(o):y}return t||(t=g,t&&t.getText()&&t.getText().setText(r.toString())),t},m=o.projection?o.projection:"EPSG:4326",h=n.getView().getProjection().getCode();t.$watch("points",function(e,t){if(e){for(var o=e.length,a=new Array,n={projection:m,label:{title:"",message:"",classNm:"",placement:"top"},coord:[0,0],lat:0,lon:0,keepOneOverlayVisible:!0,clickLabel:{},overLabel:{}},s=0;s<o;s++){var u=e[s];if(u.lon&&u.lat){var p=c({projection:m,lat:parseFloat(u.lat),lon:parseFloat(u.lon),id:u.id,name:u.name},h);a.push(p);var d=angular.copy(n);if(d.coord=[parseFloat(e[s].lon),parseFloat(e[s].lat)],d.lon=d.coord[0],d.lat=d.coord[1],d.info=e[s].info,i(u.clickLabel)){var g=u.clickLabel;d.clickLabel={id:g.id?g.id:"",title:g.title?g.title:"",message:g.message?g.message:"",url:g.url?g.url:"",classNm:g.classNm?g.classNm:"",placement:g.placement?g.placement:"top"},d.keepOneOverlayVisible=i(g.keepOneOverlayVisible)?g.keepOneOverlayVisible:d.keepOneOverlayVisible}if(i(u.ngClick)&&(d.ngClick=r),i(u.overLabel)){var f=u.overLabel;d.overLabel={title:f.title?f.title:"",message:f.message?f.message:"",url:f.url?f.url:"",classNm:f.classNm?f.classNm:"",placement:f.placement?f.placement:"top"}}p.set("featureInfo",{type:"clusterFeature",data:d}),angular.isDefined(e[s].style)&&p.set("pointStyle",e[s].style)}}l.getSource().getSource().clear(!0),l.getSource().getSource().addFeatures(a),l.setStyle(v)}},!0),t.$on("$destroy",function(){n.removeLayer(l),angular.forEach(n.getOverlays(),function(e){e.get("clickLabel")&&n.removeOverlay(e)})})})}}}]),angular.module("openlayers-directive").directive("olControl",["$log","$q","olData","olMapDefaults","olHelpers",function(e,t,r,o,a){return{restrict:"E",scope:{properties:"=olControlProperties"},replace:!1,require:"^openlayers",link:function(e,t,r,o){var n,i,l=a.isDefined,s=o.getOpenlayersScope(),c=a.createLayer;s.getMap().then(function(t){var o=a.getControlClasses,s=o();if(e.$on("$destroy",function(){t.removeControl(n)}),l(e.properties)&&l(e.properties.control))n=e.properties.control,t.addControl(n);else if(r.name){if(l(e.properties)&&(i=angular.copy(e.properties),"overviewmap"==r.name)){var u=[];i.layers.forEach(function(e){olLayer=c(e,t.getView().getProjection(),null),u.push(olLayer)}),i.layers=u}n=new s[r.name](i),t.addControl(n)}})}}}]),angular.module("openlayers-directive").directive("olDraw",["$log","$q","olMapDefaults","$interval","olHelpers","$compile",function(t,r,o,a,n,i){return{restrict:"E",require:"^openlayers",scope:{type:"=",drawEnd:"&",modifyEnd:"&"},link:function(t,r,o,a){var i,l,s=a.getOpenlayersScope();s.getMap().then(function(r){function a(e){t.modifyEnd({feature:e.features.item(0)})}function s(t){if(r.removeInteraction(i),t){var a;"Square"===t?(t="Circle",a=e.interaction.Draw.createRegularPolygon(4)):"Box"===t?(t="Circle",a=e.interaction.Draw.createBox()):"Star"===value&&(t="Circle",a=function(t,r){r||(r=new e.geom.Polygon(null));for(var o=t[0],a=t[1],n=o[0]-a[0],i=o[1]-a[1],l=Math.sqrt(n*n+i*i),s=Math.atan2(i,n),c=[],u=12,p=0;p<u;++p){var d=s+2*p*Math.PI/u,g=p%2===0?1:.5,f=l*g*Math.cos(d),y=l*g*Math.sin(d);c.push([o[0]+f,o[1]+y])}return c.push(c[0].slice()),r.setCoordinates([c]),r}),i=new e.interaction.Draw({features:p,type:t,geometryFunction:a,freehand:o.free,style:l}),i.on("drawend",c),r.addInteraction(i)}}function c(e){r.removeInteraction(i),t.drawEnd({feature:e.feature})}var u=n.createStyle,p=new e.Collection,d=new e.layer.Vector({source:new e.source.Vector({features:p})});r.addLayer(d);var g=(new e.interaction.Select({wrapX:!1}),new e.interaction.Modify({features:p,deleteCondition:function(t){return e.events.condition.shiftKeyOnly(t)&&e.events.condition.singleClick(t)}}));g.on("modifyend",a),r.addInteraction(g),t.$watch("type",function(e){e&&(o.olStyle&&(l=u(JSON.parse(o.olStyle)),d.setStyle(l)),s(e))})})}}}]),angular.module("openlayers-directive").directive("olMulPath",["$log","$q","olMapDefaults","olHelpers",function(t,r,o,a){return{restrict:"E",scope:{grids:"=olGrids"},require:"^openlayers",link:function(t,r,n,i){var l=(a.isDefined,a.createFeature,a.createVectorLayer),s=i.getOpenlayersScope();s.getMap().then(function(r){var i=(o.getDefaults(s),r.getView().getProjection().getCode()),c=l(n.zindex||0);r.addLayer(c),t.$watch("grids",function(t,r){var o=n.projection||"EPSG:4326";if(t){var l=(t.length,new Array);t.forEach(function(t){var r=new e.geom.Polygon(t.coord);r=r.transform(o,i);var n=new e.Feature({geometry:r});n.setStyle(a.createStyle(t.style)),l.push(n)}),c.getSource().clear(!0),c.getSource().addFeatures(l)}}),t.$on("$destroy",function(){r.removeLayer(c)})})}}}]),angular.module("openlayers-directive").directive("olHeatMap",["$log","$q","olMapDefaults","olHelpers",function(t,r,o,a){return{restrict:"E",scope:{points:"=points"},require:"^openlayers",link:function(t,r,o,n){var i=(a.isDefined,n.getOpenlayersScope()),l=(a.createStyle,a.createFeature);i.getMap().then(function(r){var a=new e.layer.Heatmap({source:new e.source.Vector,blur:parseInt(o.blur,10)||15,radius:parseInt(o.radius,10)||5,zIndex:parseInt(o.zindex,10)||0});a.set("heat",!0),r.addLayer(a);var n=o.projection?o.projection:"EPSG:4326",i=r.getView().getProjection().getCode();t.$watch("points",function(e,t){if(e){for(var r=e.length,o=new Array,s=0;s<r;s++){var c=e[s];if(c.lon&&c.lat){var u=l({projection:n,lat:parseFloat(c.lat),lon:parseFloat(c.lon),id:c.id},i);o.push(u),u.set("featureInfo",{type:"heatFeature",data:{}})}}a.getSource().clear(!0),a.getSource().addFeatures(o)}},!0),t.$on("$destroy",function(){r.removeLayer(a)})})}}}]),angular.module("openlayers-directive").directive("olInteraction",["$log","$q","olData","olMapDefaults","olHelpers",function(t,r,o,a,n){var i=function(){function t(e){return r.map(function(e){return e.map}).indexOf(e)}var r=[],o=new e.Collection;return{getInst:function(e,o){var a=t(o);if(a===-1){var i=n.createVectorLayer();i.set("draws",!0),o.addLayer(i),r.push({map:o,drawLayer:i,instScopes:[]}),a=r.length-1}return r[a].instScopes.push(e),r[a].drawLayer},getModifyColletion:function(){return o},setModifyColletion:function(e){o=e},deregisterScope:function(e,o){var a=t(o);if(a===-1)throw Error("This map has no features");var n=r[a].instScopes,i=n.indexOf(e);if(i===-1)throw Error("Scope wan't registered");n.splice(i,1),n.length||(delete r[a].drawLayer,delete r[a])}}}();return{restrict:"E",scope:{properties:"=olInteractionProperties"},replace:!1,require:"^openlayers",link:function(t,r,o,l){var s,c=n.isDefined,u=l.getOpenlayersScope(),p=(n.createFeature,n.createOverlay,n.createVectorLayer,n.createStyle),d=a.getDefaults(u),g="",f="",y="";u.getMap().then(function(r){var a=n.getInteractionClasses,l=a();if(t.$on("$destroy",function(){g&&r.removeInteraction(g),f&&r.removeInteraction(f),r.removeInteraction(y),r.un("click",t.delItem)}),c(t.properties)&&c(t.properties.interaction));else if(o.name&&c(t.properties))switch(s=angular.copy(t.properties),o.name){case"dragZoom":switch(s.condition){case"mouseOnly":s.condition=e.events.condition.mouseOnly;break;case"shiftKeyOnly":s.condition=e.events.condition.shiftKeyOnly}g=new l[o.name](s),r.addInteraction(g);break;case"draw":var u=i.getInst(t,r);if(c(s.style)){var v=p(s.style);s.style=v}g=new l[o.name](s),r.addInteraction(g),g.on("drawstart",function(e){var r=e.feature;if(s.changeStyle instanceof Function){if(s.changeStyle(),s=angular.copy(t.properties),c(s.style)){var o=p(s.style);r.setStyle(o),u.getSource().addFeature(r)}}else if(s.style){var o=p(s.style);r.setStyle(o),u.getSource().addFeature(r)}else{var o=p(d.styles.feature);r.setStyle(o),u.getSource().addFeature(r)}}),g.on("drawend",function(e){if(s.modify){var t=i.getModifyColletion();""==f&&(f=new l.modify({features:t}),r.addInteraction(f));var o=e.feature;t.push(o),i.setModifyColletion(t)}s.drawFinished instanceof Function&&s.drawFinished(e.feature)});break;case"del":var m=[];t.delItem=function(e){var t=r.forEachFeatureAtPixel(e.pixel,function(e){return e});t&&t.getGeometry().getType()&&(m.push(t),t.getStyle()&&t.getStyle().getFill()&&t.getStyle().getFill().setColor("rgba(255,0,0,1)"),t.getStyle()&&t.getStyle().getStroke()&&t.getStyle().getStroke().setColor("rgba(255,0,0,1)"),t.getStyle()&&t.getStyle().getImage()&&(t.getStyle().getImage().getFill().setColor("rgba(255,0,0,1)"),t.getStyle().getImage().getStroke().setColor("rgba(255,0,0,1)"))),e.preventDefault()},y=new l.select({wrapX:!1}),r.addInteraction(y),r.on("click",t.delItem),t.$watch("properties.del",function(e,o){e&&(m.forEach(function(e){i.getInst(t,r).getSource().removeFeature(e)}),m=[],t.properties.del=!1)})}})}}}]),angular.module("openlayers-directive").directive("olLayer",["$log","$q","olMapDefaults","olHelpers",function(e,t,r,o){return{restrict:"E",scope:{properties:"=olLayerProperties",onLayerCreated:"&"},replace:!1,require:"^openlayers",link:function(e,t,a,n){var i=o.isDefined,l=o.equals,s=n.getOpenlayersScope(),c=o.createLayer,u=o.setVectorLayerEvents,p=o.detectLayerType,d=o.createStyle,g=o.isBoolean,f=o.addLayerBeforeMarkers,y=o.isNumber,v=o.insertLayer,m=o.removeLayer,h=o.addLayerToGroup,w=o.removeLayerFromGroup,S=o.getGroup;s.getMap().then(function(t){var o,n=t.getView().getProjection(),b=r.setDefaults(s),k=t.getLayers();if(e.$on("$destroy",function(){e.properties.group?w(k,o,e.properties.group):m(k,o.index),t.removeLayer(o)}),i(e.properties))e.$watch("properties",function(r,a){if(i(r.source)&&i(r.source.type)){if(!i(r.visible))return void(r.visible=!0);if(!i(r.opacity))return void(r.opacity=1);var s,L,O;if(i(o)){var x=function(e){return function(t){return t!==e}}(o);if(i(a)&&!l(r.source,a.source)){var F=o.index;O=k,L=o.get("group"),L&&(O=S(k,L).getLayers()),O.removeAt(F),o=c(r,n,e.onLayerCreated),o.set("group",L),i(o)&&(v(O,F,o),"Vector"===p(r)&&u(b.events,t,e,r.name))}(i(a)&&r.opacity!==a.opacity||x(o))&&(y(r.opacity)||y(parseFloat(r.opacity)))&&o.setOpacity(r.opacity),i(r.index)&&r.index!==o.index&&(O=k,L=o.get("group"),L&&(O=S(k,L).getLayers()),m(O,o.index),v(O,r.index,o)),i(r.group)&&r.group!==a.group&&(w(k,o,a.group),h(k,o,r.group)),(i(a)&&g(r.visible)&&r.visible!==a.visible||x(o))&&o.setVisible(r.visible),(i(r.style)&&!l(r.style,a.style)||x(o))&&(s=angular.isFunction(r.style)?r.style:d(r.style),o.setStyle&&angular.isFunction(o.setStyle)&&o.setStyle(s)),l(r.minResolution,a.minResolution)&&!x(o)||i(r.minResolution)&&o.setMinResolution(r.minResolution),l(r.maxResolution,a.maxResolution)&&!x(o)||i(r.maxResolution)&&o.setMaxResolution(r.maxResolution)}else o=c(r,n,e.onLayerCreated),i(r.group)?h(k,o,r.group):i(r.index)?v(k,r.index,o):f(k,o),"Vector"===p(r)&&u(b.events,t,e,r.name),g(r.visible)&&o.setVisible(r.visible),r.opacity&&o.setOpacity(r.opacity),angular.isArray(r.extent)&&o.setExtent(r.extent),r.style&&(s=angular.isFunction(r.style)?r.style:d(r.style),o.setStyle&&angular.isFunction(o.setStyle)&&o.setStyle(s)),r.minResolution&&o.setMinResolution(r.minResolution),r.maxResolution&&o.setMaxResolution(r.maxResolution)}},!0);else if(i(a.sourceType)&&i(a.sourceUrl)){var L={source:{url:a.sourceUrl,type:a.sourceType}};o=c(L,n,a.layerName,e.onLayerCreated),"Vector"===p(L)&&u(b.events,t,e,a.name),f(k,o)}})}}}]),angular.module("openlayers-directive").directive("olMarker",["$log","$q","olMapDefaults","olHelpers",function(t,r,o,a){var n=function(){return{id:"",projection:"EPSG:4326",lat:0,lon:0,coord:[],show:!0,showOnMouseOver:!1,showOnMouseClick:!1,keepOneOverlayVisible:!0,ngClick:!1,clickLabel:{},overLabel:{},info:{}}},i=function(){function e(e){return t.map(function(e){return e.map}).indexOf(e)}var t=[];return{getInst:function(r,o){var n=e(o);if(n===-1){var i=a.createVectorLayer();i.set("markers",!0),o.addLayer(i),t.push({map:o,markerLayer:i,instScopes:[]}),n=t.length-1}return t[n].instScopes.push(r),t[n].markerLayer},deregisterScope:function(r,o){var a=e(o);if(a===-1)throw Error("This map has no markers");var n=t[a].instScopes,i=n.indexOf(r);if(i===-1)throw Error("Scope wan't registered");n.splice(i,1),n.length||(o.removeLayer(t[a].markerLayer),delete t[a].markerLayer,delete t[a])}}}();return{restrict:"E",scope:{lat:"=lat",lon:"=lon",properties:"=olMarkerProperties",style:"=olStyle"},transclude:!0,require:"^openlayers",replace:!0,template:'<div class="popup-label marker"><div ng-bind-html="message"></div><ng-transclude></ng-transclude></div>',link:function(r,l,s,c){var u=a.isDefined,p=c.getOpenlayersScope(),d=a.createFeature,g=a.createOverlay,f=a.createStyle,y=l.find("ng-transclude").children().length>0;p.getMap().then(function(a){var c=i.getInst(r,a);c.setZIndex(2);var v,m,h,w=n(),S=o.getDefaults(p),b=a.getView().getProjection().getCode();return r.$on("$destroy",function(){h&&c.getSource().removeFeature(h),v&&a.removeOverlay(v),angular.forEach(a.getOverlays(),function(e){r.properties.clickLabel&&e.getId()==r.properties.clickLabel.id&&a.removeOverlay(e)}),i.deregisterScope(r,a)}),u(r.properties)?void r.$watch("properties",function(o){if(o.lon=parseFloat(o.lon),o.lat=parseFloat(o.lat),u(h)){var n;if(n="pixel"===o.projection?o.coord:e.proj.transform([o.lon,o.lat],w.projection,a.getView().getProjection()),!angular.equals(h.getGeometry().getCoordinates(),n)){var i=new e.geom.Point(n);h.setGeometry(i)}if(u(o.style)){var p=f(o.style);h.setStyle(p)}h.get("overLay")&&h.get("overLay").getMap()&&h.get("overLay").setPosition(n),w.coord=o.coord?o.coord:w.coord,w.lat=o.lat?o.lat:w.lat,w.lon=o.lon?o.lon:w.lon,w.info=o.info?o.info:w.info,u(o.style)&&(w.style=o.style)}else{if(w.id=o.id?o.id:w.id,w.projection=o.projection?o.projection:w.projection,w.coord=o.coord?o.coord:w.coord,w.lat=isNaN(o.lat)?w.lat:parseFloat(o.lat),w.lon=isNaN(o.lon)?w.lon:parseFloat(o.lon),w.info=o.info?o.info:w.info,!w.lat||!w.lon)return console.log("缺失经纬度"),!1;if(u(o.overLabel)){var y=o.overLabel;y.url?$.get(o.overLabel.url,function(e){w.overLabel={title:y.title?y.title:"",message:e,classNm:y.classNm?y.classNm:"markerOver",placement:y.placement?y.placement:"top"}}):y.message&&(w.overLabel={title:y.title?y.title:"",message:y.message?y.message:"",classNm:y.classNm?y.classNm:"",placement:y.placement?y.placement:"top"})}if(u(o.clickLabel)){var k=o.clickLabel;w.clickLabel={id:k.id?k.id:"",title:k.title?k.title:"",message:k.message?k.message:"",url:k.url?k.url:"",classNm:k.classNm?k.classNm:"",placement:k.placement?k.placement:"top"},w.keepOneOverlayVisible=u(k.keepOneOverlayVisible)?k.keepOneOverlayVisible:w.keepOneOverlayVisible}s.ngClick&&(w.ngClick=l),u(o.style)?w.style=o.style:w.style=S.styles.marker,h=d(w,b),u(h)||t.error("[AngularJS - Openlayers] Received invalid data on the marker."),h.set("featureInfo",{type:"marker",data:w}),c.getSource().addFeature(h)}if(o.clickLabel&&1==o.clickLabel.remove&&angular.forEach(a.getOverlays(),function(e){e.getId()==o.clickLabel.id&&(a.removeOverlay(e),delete r.properties.clickLabel.remove)}),u(v)&&a.removeOverlay(v),u(o.label)){if(u(o.label)){var L=o.label;L.url?$.get(L.url,function(e){r.$apply(function(){r.message=e})}):L.message&&(r.message=L.message)}o.label&&o.label.show===!0&&(m="pixel"===w.projection?w.coord:e.proj.transform([o.lon,o.lat],w.projection,b),v=g(l,m),a.addOverlay(v)),v&&o.label&&o.label.show===!1&&(a.removeOverlay(v),v=void 0)}},!0):(w.lat=r.lat?r.lat:w.lat,w.lon=r.lon?r.lon:w.lon,w.message=s.message,w.label={title:s.title?s.title:"",message:s.message?s.message:"",classNm:s.classNm?s.classNm:"",placement:s.placement?s.placement:"top"},w.style=r.style?r.style:S.styles.marker,s.hasOwnProperty("ngClick")&&(w.ngClick=!0),h=d(w,b),u(h)||t.error("[AngularJS - Openlayers] Received invalid data on the marker."),h.set("featureInfo",{type:"marker",data:w}),c.getSource().addFeature(h),void((w.message||y)&&(r.message=s.message,m=e.proj.transform([w.lon,w.lat],w.projection,b),v=g(l,m),a.addOverlay(v))))})}}}]),angular.module("openlayers-directive").directive("olMeasure",["$log","$q","olMapDefaults","$interval","olHelpers","$compile",function(t,r,o,a,n,i){return{restrict:"E",require:"^openlayers",scope:{type:"=type"},link:function(t,r,o,a){var l,s,c,u,p,d,g,f,y,v,m=(n.isDefined,a.getOpenlayersScope()),h=n.createOverlay,w=n.createFeature,S=t.type,b=!0,k=0,L=[];m.getMap().then(function(r){function o(e){s&&s.parentNode.removeChild(s),s=document.createElement("div"),s.className="tooltip hidden",c=h($(s)),c.set("name",e),c.setOffset([15,30]),r.addOverlay(c)}function a(e){u&&u.parentNode.removeChild(u),u=document.createElement("div"),u.className="tooltip tooltip-measure",p=h($(u)),p.set("name",e),p.setOffset([15,30]),r.addOverlay(p)}function n(e){d&&d.parentNode.removeChild(d),d=document.createElement("div"),d.className="tooltip tooltip-distance",g="del"==arguments[1]?h($(d),void 0,"distanceNum",!0):h($(d),void 0,"distanceNum",!1),g.set("name",e),g.setOffset([10,0]),r.addOverlay(g)}function m(t,r){var o={coords:t,style:{image:new e.style.Circle({radius:4,fill:new e.style.Fill({color:"white"}),stroke:new e.style.Stroke({color:"#005699",width:2})})}},a=w(o,x);a.set("id",r),M.addFeature(a)}function O(){L=[],L.push(P),f=new e.interaction.Draw({source:M,type:S,style:L}),r.addInteraction(f),a("measure1"),o("measure");var s;f.on("drawstart",function(t){b=!0,k++,l=t.feature;var o="measure"+k;l.set("id",o);var a=t.coordinate;v=r.on("click",function(e){var t=l.getGeometry().getLastCoordinate();"LineString"==S&&(d=null,n(o),d.innerHTML="起点",g.setPosition(t)),m(t,o)}),s=l.getGeometry().on("change",function(t){var i=t.target,l="",s="";i instanceof e.geom.Polygon?(s=j(i),l+="<div>面积："+s+"</div><div>单击继续绘制，双击结束</div>",a=F):i instanceof e.geom.LineString&&(s=C(i),l="<div>总长："+s+"</div><div>单击继续绘制，双击结束</div>",a=i.getLastCoordinate()),u.innerHTML=l,p.setPosition(a),v&&e.Observable.unByKey(v),v=r.on("click",function(e){"LineString"==S&&(d=null,n(o),d.innerHTML=s,g.setPosition(a)),m(a,o)})})},this),f.on("drawend",function(r){b=!1;var o,c,f=l.getGeometry(),y="";if(f instanceof e.geom.Polygon){y+="<div>面积："+j(f)+"</div>";var m=f.getInteriorPoint().getCoordinates();o=f.getCoordinates()[0],c=o.length,p.setPosition(m),p.setOffset([0,-7])}else f instanceof e.geom.LineString&&(o=f.getCoordinates(),c=o.length,y="<div>总长："+C(f)+"</div>",o[c-1][1]>o[c-2][1]?p.setOffset([-5,-25]):p.setOffset([-5,25]));u.innerHTML=y,u.className="tooltip tooltip-static",d&&2!=d.childNodes.length&&(d=null),n(l.get("id"));var h="<i class='fa fa-close' style='cursor:pointer;' ng-click='delObj(\""+l.get("id")+"\")'></i>",w=i(h)(t);angular.element(d).html(w),d.className="tooltip tooltip-close",g.setPosition(f.getLastCoordinate()),o[c-1][0]>o[c-2][0]?g.setOffset([10,0]):g.setOffset([-25,0]),l=null,u=null,a("measure"+(k+1)),e.Observable.unByKey(s),e.Observable.unByKey(v)},this)}var x=r.getView().getProjection().getCode();$("canvas").css("cursor","url(./images/measure.png),auto"),t.$on("$destroy",function(){$("canvas").css("cursor","default"),r.removeLayer(T),r.removeInteraction(f);for(var t=r.getOverlays(),o=t.getLength(),a=o-1;a>=0;a--)t.item(a).get("name")&&t.item(a).get("name").indexOf("measure")!=-1&&t.removeAt(a);e.Observable.unByKey(y),$(r.getViewport()).off("mouseout")});var F,C=function(e){var t,r=Math.round(100*e.getLength())/100;return t=r>100?"<span>"+Math.round(r/1e3*100)/100+"</span> km":"<span>"+Math.round(100*r)/100+"</span> m"},j=function(e){var t,r=e.getArea();return t=r>1e4?"<span>"+Math.round(r/1e6*100)/100+"</span> km<sup>2</sup>":"<span>"+Math.round(100*r)/100+"</span> m<sup>2</sup>"},E=function(e){e.dragging||(F=e.coordinate,l?$(s).addClass("hidden"):(s.innerHTML="单击确定起点",c.setPosition(e.coordinate),$(s).removeClass("hidden")))};y=r.on("pointermove",E),$(r.getViewport()).on("mouseout",function(){$(s).addClass("hidden")});var M=new e.source.Vector,P=new e.style.Style({fill:new e.style.Fill({color:"rgba(142, 77, 209, 0.3)"}),stroke:new e.style.Stroke({color:"rgba(142, 77, 209, 0.7)",lineDash:[10,5],width:2}),image:new e.style.Circle({radius:2,fill:new e.style.Fill({color:"white"}),stroke:new e.style.Stroke({color:"#005699",width:2})})}),I=new e.style.Style({fill:new e.style.Fill({color:"rgba(142, 77, 209, 0.3)"}),stroke:new e.style.Stroke({color:"#8e4dd1",width:2})}),T=new e.layer.Vector({source:M,style:I});r.addLayer(T),t.$watch("type",function(e,o){r.removeInteraction(f),S=t.type,O()}),t.delObj=function(e){for(var t=M.getFeatures(),o=t.length,a=o-1;a>=0;a--)t[a].get("id")==e&&M.removeFeature(t[a]);for(var n=r.getOverlays(),i=n.getLength(),a=i-1;a>=0;a--)n.item(a).get("name")==e&&n.removeAt(a)}})}}}]),angular.module("openlayers-directive").directive("olNearby",["$log","$q","olMapDefaults","olHelpers",function(t,r,o,a){return{restrict:"E",scope:{coords:"=",radius:"=",refreshData:"&"},require:"^openlayers",replace:!0,template:'<div class="nearby-control-point"><a></a><label ng-click="editDis($event)"><span ng-bind="radius" ng-hide="edit"></span><input ng-model="radius" ng-show="edit" />m</label></div>',link:function(t,r,o,n){var i,l,s,c,u=(a.isDefined,a.createFeature),p=a.createOverlay,d=a.createVectorLayer,g=a.getGeodesicDistance,f=n.getOpenlayersScope(),y=!1;t.edit=!1,f.getMap().then(function(a){function n(){if(l=e.proj.transform(t.coords,h,m),t.radius){c=g(m,l,[l[0]+1,l[1]]);var o=t.radius/c}var n={type:"Circle",coords:l,radius:o,projection:m,style:w};s=u(n,m),v.getSource().addFeature(s);var d=v.getSource().getExtent();a.getView().fit(d,{size:a.getSize(),padding:[15,15,15,15],duration:1e3});var f=[l[0]+o,l[1]];i=p(r,f),a.addOverlay(i)}function f(e,t,r){var o=e.getBoundingClientRect();return[t-o.left-(o.width-$(e).width())/2,r-o.top-(o.height-$(e).height())/2]}t.$on("$destroy",function(){a.removeLayer(v),a.removeOverlay(i)});var v=d(o.zindex||0);a.addLayer(v);var m=a.getView().getProjection().getCode(),h=o.projection||"EPSG:4326",w={fill:{color:[110,162,228,.3]},stroke:{width:1,color:[110,162,228]}};t.$watch("coords",function(e,t){e&&2==e.length&&n()});var S=$(".nearby-control-point>a");S.on("mousedown",function(e){var r=s.getGeometry().getRadius(),o=i.getPosition(),n=a.getCoordinateFromPixel(f(a.getViewport(),e.clientX,e.clientY));$(a.getViewport()).on("mousemove",function(e){y=!0;var c=a.getCoordinateFromPixel(f(a.getViewport(),e.clientX,e.clientY));i.setPosition([o[0]+c[0]-n[0],l[1]]);var u=Math.abs(c[0]-n[0]+r);s.getGeometry().setRadius(u);var p=g(m,l,[l[0]+u,l[1]]);return t.radius=parseInt(p),t.$apply(),!1}),$(a.getViewport()).on("mouseup",function(e){var r=v.getSource().getExtent();return a.getView().fit(r,{size:a.getSize(),padding:[5,5,5,5],duration:1e3}),i.setPosition([l[0]+s.getGeometry().getRadius(),l[1]]),$(a.getViewport()).off("mousemove"),$(a.getViewport()).off("mouseup"),t.refreshData(),t.$apply(),y=!1,!1})}),t.editDis=function(e){y||(t.edit=!0,e.stopPropagation(),$(a.getViewport()).on("mousedown",function(e){if(t.edit&&"input"!=e.target.tagName.toLowerCase()){t.edit=!1,radius=t.radius/c,s.getGeometry().setRadius(radius),i.setPosition([l[0]+radius,l[1]]);var r=v.getSource().getExtent();a.getView().fit(r,{size:a.getSize(),padding:[5,5,5,5],duration:1e3}),$(a.getViewport()).off("mousedown"),t.refreshData(),t.$apply()}}))}})}}}]),angular.module("openlayers-directive").directive("olOverlay",["$log","$sce","$compile","olMapDefaults","olHelpers",function(e,t,r,o,a){return{restrict:"E",scope:{coord:"=coord",label:"=label"},require:"^openlayers",link:function(e,t,r,o){var n=(a.isDefined,o.getOpenlayersScope()),i=(a.createOverlay,a.setMarkerEvent),l=null;r.projection||(r.projection="EPSG:4326");var s={projection:r.projection,coord:e.coord,label:angular.copy(e.label)};n.getMap().then(function(t){t.getView().getProjection().getCode();e.changeProperty=function(){s.label.url?$.get(s.label.url,function(r){l&&t.removeOverlay(l),s.label.message=r,l=i(null,t,s,e.$parent),e.$apply()}):l=i(null,t,s,e.$parent)},e.$watchGroup(["coord","label"],function(r,o){r&&r[0]&&r[1]&&(s.coord=e.coord,s.label=angular.copy(e.label),l&&t.removeOverlay(l),e.changeProperty())}),e.$on("$destroy",function(){l&&t.removeOverlay(l)})})}}}]),angular.module("openlayers-directive").directive("olPath",["$log","$q","olMapDefaults","olHelpers",function(e,t,r,o){return{restrict:"E",scope:{coords:"=",style:"=olStyle",createEnd:"&"},require:"^openlayers",link:function(e,t,a,n){var i,l,s=o.isDefined,c=o.createFeature,u=o.createOverlay,p=o.createVectorLayer,d=o.insertLayer,g=(o.removeLayer,n.getOpenlayersScope());g.getMap().then(function(t){var n=r.getDefaults(g),f=t.getView().getProjection().getCode(),y=p(a.zindex||0),v=t.getLayers();if(d(v,v.getLength(),y),e.$on("$destroy",function(){t.removeLayer(y),t.removeOverlay(i)}),s(a.coords)){var m=a.projection||"EPSG:4326",h=parseFloat(a.radius)||0,w=a.type?a.type:"Polygon",S=n.styles.path;"Circle"!=w&&(S=n.styles.feature)}e.$watch("coords",function(r,n){if(r&&r[0]){m=a.projection||"EPSG:4326";var s=r;if(l)l.getGeometry().setCoordinates(s),l.getGeometry().transform(m,f);else{if(0!=h){var p=o.getGeodesicDistance,d=p(m,s,[s[0]+1,s[1]]);h/=d}var g={id:a.id,type:w,coords:s,radius:h,projection:m,style:e.style?e.style:S};if(l=c(g,f),y.getSource().addFeature(l),e.createEnd&&e.createEnd({feature:l}),a.message){var v=$('<div class="popup-label path">'+a.message+"</div>"),b=l.getGeometry().getExtent();i=u(v,b,"",!1),t.addOverlay(i)}}}},!0)})}}}]),angular.module("openlayers-directive").directive("olPlot",["$log","$q","olMapDefaults","$interval","olHelpers","$compile",function(r,o,a,n,i,l){var s=function(){function e(e){return r.map(function(e){return e.map}).indexOf(e)}var r=[];return{getInst:function(o,a){var n=e(a);if(n===-1){var l=i.createVectorLayer(2);l.set("plotLayer",!0),a.addLayer(l);var s=new t.PlotDraw(a),c=new t.PlotEdit(a);r.push({map:a,plotLayer:l,plotDraw:s,plotEdit:c,instScopes:[]}),n=r.length-1}return r[n].instScopes.push(o),r[n]},deregisterScope:function(t,o){var a=e(o);if(a===-1)throw Error("This map has no markers");var n=r[a].instScopes,i=n.indexOf(t);if(i===-1)throw Error("Scope wan't registered");n.splice(i,1),n.length||(o.removeLayer(r[a].plotLayer),delete r[a].plotLayer,delete r[a])}}}();return{restrict:"E",require:"^openlayers",scope:{type:"=",noEdit:"=",drawEnd:"&",hasFeatures:"=",delObj:"&",isClear:"@",editUrl:"@"},controller:"SucPlotController",controllerAs:"plotOl",replace:!0,template:'<div class="hidden"><div ng-repeat="item in textLays"><plot-text properties="item"></plot-text></div></div>',link:function(r,o,n,c){var u,p,d,g,f=(i.createVectorLayer,c.getOpenlayersScope()),y=(i.setClickMarker,i.createOverlay),v=i.createStyle;r.textLays=[];var m,h,w,S,b="";f.getMap().then(function(o){function i(e){w&&w.parentNode.removeChild(w),
w=document.createElement("div"),w.className="tooltip hidden",S=y($(w)),S.set("name",e),S.setOffset([15,30]),o.addOverlay(S)}function c(e){r.selectedFeature=e;var t=e.get("plotType").bigClass,a=e.getStyle();r.plotOl.type=t,"icon"==t?r.plotOl.selectedFillColor={color:a.getImage().getColor(),width:null}:(r.plotOl.selectedStrokeColor={color:a.getStroke().getColor(),width:a.getStroke().getWidth()},"area"==t&&(r.plotOl.selectedFillColor={color:a.getFill().getColor(),width:null})),r.plotOl.open=!0;var n=e.getGeometry().getExtent(),i=[n[2],(n[1]+n[3])/2];if(m)e.set("plotLay",m),m.setPosition(i),$(".sucPlotTemplate").removeClass("hidden");else{var s="plugin/OpenLayers/p-ol3/overlay/editOverlay.html";s=r.editUrl?r.editUrl:s,$.get(s,function(t){var a='<div class="sucPlotTemplate">'+t+"</div>";m=y(l(a)(r),i,"editLay"),o.addOverlay(m),m.setOffset([10,0]),e.set("plotLay",m)})}r.$apply()}function k(e,t,a){var n=e.getGeometry().getExtent(),i=[n[2],(n[1]+n[3])/2],l="textLay"+(a?"Load":"")+r.textLays.length;r.textLays.push({id:l,map:o,pos:i,feature:e,type:t,note:a}),e.set("plotLay",l+"&"+t),a||r.$apply()}function L(e){p.deactivate(),$(".sucPlotTemplate").addClass("hidden"),u.activate(e),h=null}function O(t){var o=t.feature,a=r.type;if(a.indexOf("-")!=-1&&(a=a.split("-")[0]),r.type.indexOf("text")!=-1)o.setStyle(new e.style.Style({image:new e.style.Circle({radius:5,fill:new e.style.Fill({color:"rgba(32, 88, 165, 0)"}),stroke:new e.style.Stroke({color:"rgba(32, 88, 165, 0)"})})})),o.set("plotType",{bigClass:"text",type:"MARKER"}),r.type.indexOf("textVertical")!=-1?k(o,1):k(o,0);else if(r.type.indexOf("icon")!=-1){var i;i=n.icon?new e.style.Style({image:new e.style.Icon({anchor:[.5,1],color:[32,88,165],src:n.icon})}):C,o.setStyle(i),o.set("plotType",{bigClass:"icon",type:"MARKER"}),r.noEdit||c(o)}else{if(r.type.endWith("line"))o.setStyle(new e.style.Style({stroke:new e.style.Stroke({color:"#2058A5",width:3,lineDash:[8,12]})})),o.set("plotType",{bigClass:"line",type:a});else{o.setStyle(g);var l="area";"POLYLINE"!=r.type&&"CURVE"!=r.type||(l="area_line"),o.set("plotType",{bigClass:l,type:a})}r.noEdit||c(o)}d.getSource().addFeature(o),r.noEdit||p.activate(o),r.type="",r.drawEnd({feature:o}),r.$apply()}var x=s.getInst(r,o);d=x.plotLayer,u=x.plotDraw,u.on(t.Event.PlotDrawEvent.DRAW_END,O,!1,this),p=x.plotEdit;var F=a.getDefaults(f),C=v(F.styles.marker);r.$on("$destroy",function(){p.deactivate(),u.deactivate(),e.Observable.unByKey(T),s.deregisterScope(r,o),o.removeOverlay(m),e.Observable.unByKey(E),$(o.getViewport()).off("mouseout"),$(o.getViewport()).off("contextmenu"),o.removeOverlay(S),r.textLays=[]});var j=function(e){e.dragging||(h?$(w).addClass("hidden"):w&&(w.innerHTML=b,S.setPosition(e.coordinate),$(w).removeClass("hidden")))},E=o.on("pointermove",j);$(o.getViewport()).on("mouseout",function(){$(w).addClass("hidden")}),$(o.getViewport()).on("contextmenu",function(e){return u.deactivate(),h=!0,r.type="",r.$apply(),!1});var M=new e.style.Stroke({color:"#2058A5",width:2}),P=new e.style.Fill({color:[32,88,165,.4]});g=new e.style.Style({fill:P,stroke:M}),r.$watch("isClear",function(e,t){e&&(p.deactivate(),d.getSource().clear(),$(".sucPlotTemplate").addClass("hidden"),u.deactivate(),h=!0,r.textLays=[],r.isClear=!1)});var I=[];r.$watch("hasFeatures",function(a,n){n&&(p.deactivate(),d.getSource().clear(),$(".sucPlotTemplate").addClass("hidden"),u.deactivate(),h=!0,r.textLays=[]),a&&a.forEach(function(r){var a=r.coords;o.getView().setCenter(a[0]);var n=new t.PlotFactory.createPlot(t.PlotTypes[r.plotType.type],a),i=new e.Feature(n);i.setStyle(v(r.style)),i.set("plotType",r.plotType),r.text&&(1==r.textType?k(i,1,r.text):k(i,0,r.text)),d.getSource().addFeature(i),I.push(i)})});var T=o.on("singleclick",function(e){if(h=!0,$(w).addClass("hidden"),!u.isDrawing()){var t=o.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(t&&t.get("plotType")){if(r.noEdit)return!1;p.activate(t);var a=t.get("plotType").bigClass;"text"!=a&&c(t)}else p.deactivate(),$(".sucPlotTemplate").addClass("hidden"),r.selectedFeature="",r.plotOl.closeTextMenu=!0}});r.delObj=function(){d&&p&&p.activePlot&&(d.getSource().removeFeature(p.activePlot),$(".sucPlotTemplate").addClass("hidden"),p.deactivate(),r.delObj({feature:p.activePlot}))},String.prototype.endWith=function(e){var t=this.length-e.length;return t>=0&&this.lastIndexOf(e)==t},r.$watch("type",function(e){if(e){b="点击左键开始绘制，双击结束绘制，右键退出";var r=e;r.indexOf("text")==-1&&r.indexOf("icon")==-1||(b="可左键点击想要标记的位置，右键退出"),r.indexOf("-")!=-1&&(r=r.split("-")[0]),L(t.PlotTypes[r]),i("plot")}})})}}}]).controller("SucPlotController",["$scope",function(e){this.open=!0,this.type="line"}]).controller("colorManage",["$scope",function(t){t.$watch("plotOl.selectedFillColor",function(r,o){var a=t.selectedFeature;if(a){var n=angular.copy(a.getStyle()),i=n.getFill();i&&(i.setColor(r.color),a.setStyle(n));var l=n.getImage();if(l){var s=new e.style.Icon({anchor:[.5,1],color:r.color,src:l.getSrc()});n.setImage(s),a.setStyle(n)}}},!0),t.$watch("plotOl.selectedStrokeColor",function(e,r){var o=t.selectedFeature;if(o){var a=angular.copy(o.getStyle()),n=a.getStroke();n&&(n.setColor(e.color),n.setWidth(parseFloat(e.width)),o.setStyle(a))}},!0)}]),angular.module("openlayers-directive").directive("plotText",["$q","olMapDefaults","olHelpers",function(e,t,r){return{restrict:"E",require:"^olPlot",scope:{properties:"="},replace:!0,templateUrl:"plugin/OpenLayers/p-ol3/overlay/textOverlay.html",link:function(e,t,o,a){var n=r.createOverlay(t,e.properties.pos,e.properties.id);e.properties.map.addOverlay(n),e.status=0,e.note={};var i=e.properties.type,l=e.properties.note;1==i&&e.$watch("note.edit",function(t,r){t?e.status=0:e.status=1}),l?(e.note.edit=!1,e.note.text=l,e.close=!0):e.note.edit=!0,$(e.properties.map.getViewport()).on("click",function(t){e.note.edit||(e.close=!0,e.$apply())}),t.parent().draggable({handle:".angularOl_textOuter",stop:function(){var r=parseFloat(t.parent().css("left")),o=parseFloat(t.parent().css("top")),a=e.properties.map.getCoordinateFromPixel([r,o]);n.setPosition(a),e.properties.feature.getGeometry().updatePoint(a,0)}}),e.delTextlay=function(){e.properties.map.removeOverlay(n),e.properties.map.getLayers().forEach(function(t){t.get("plotLayer")&&t.getSource().removeFeature(e.properties.feature)})},e.$on("$destroy",function(){e.properties.map.removeOverlay(n)})}}}]),angular.module("openlayers-directive").directive("olRealtrack",["$log","$q","olMapDefaults","$compile","olHelpers",function(t,r,o,a,n){return{restrict:"E",require:"^openlayers",scope:{properties:"=olRealtrackProperties",data:"=data"},transclude:!0,replace:!0,template:'<div><ol-path coords="trackLine.coords" ol-style="trackLine.style" type="LineString" ng-repeat="trackLine in carTrack.trackLines"></ol-path><ol-marker ol-marker-properties="carTrack.car" ng-click="carTrack.car.clickFunc()"></ol-marker></div>',link:function(t,r,a,i){var l=i.getOpenlayersScope(),s=[],c=a.projection?a.projection:"EPSG:4326",u=n.getGreatCircleDistance,p=n.isDefined,d=a.isCenter;t.carTrack={car:{},trackPoints:[],trackLines:[]},angular.extend(t.carTrack.car,JSON.parse(a.carProperties)),l.getMap().then(function(r){var n=o.getDefaults(l),i=n.view.projection;t.drawRoute=function(e){if(!(e<1||e>s.length-1)){var r=JSON.parse(a.lineProperties);r.style||(r.style=n.styles.path),r.coords=[[parseFloat(s[e-1].lon),parseFloat(s[e-1].lat)],[parseFloat(s[e].lon),parseFloat(s[e].lat)]],r.projection=c;var o=u(c,r.coords[1],r.coords[0]);a.interval&&o>34*a.interval?r.style.stroke.lineDash=[4,10]:p(r.style.stroke.lineDash)&&delete r.style.stroke.lineDash,t.carTrack.trackLines.push(r)}},t.$watch("data",function(o){if(o&&o.lat){s.push(o);var a=s.length;t.drawRoute(a-1);var n=t.carTrack.car.style;n&&n.image&&n.image.icon&&void 0!=n.image.icon.rotation&&(n.image.icon.rotation=o.direction?parseFloat(o.direction)/180*Math.PI:0),t.carTrack.car.lat=o.lat,t.carTrack.car.lon=o.lon,t.carTrack.car.projection=c;var l;l="pixel"===c?[parseFloat(o.lon),parseFloat(o.lat)]:e.proj.transform([parseFloat(o.lon),parseFloat(o.lat)],c,i);var u=r.getView();if(d)u.setCenter(l);else{var p=r.getSize(),g=u.calculateExtent(p);e.extent.containsCoordinate(g,l)||u.setCenter(l)}}},!0)})}}}]),angular.module("openlayers-directive").directive("olTrack",["$log","$q","olMapDefaults","$interval","olHelpers",function(t,r,o,a,n){return{restrict:"E",require:"^openlayers",scope:{interval:"=interval",status:"=status",go:"=go",showRoute:"=showRoute"},link:function(t,r,i,l){var s,c,u=l.getOpenlayersScope(),p=i.isCenter,d=JSON.parse(i.points),g=d.length,f=i.projection?i.projection:"EPSG:4326",y=[];t.carTrack={car:{},trackPoints:[],trackLines:[],route:{toShowLine:!1,coords:[],style:JSON.parse(i.routeProperties).style}},i.carProperties&&angular.extend(t.carTrack.car,JSON.parse(i.carProperties)),u.getMap().then(function(r){function l(r){if(!(r<1||r>g-1))for(var o=1;o<=r;o++)if(y.indexOf(o)==-1){var a=[d[o-1].coord,d[o].coord],n=new e.geom.LineString(a);n=n.transform(f,m);var i=new e.Feature(n);if(i.set("type","line"),i.set("finished","play"!=t.status),d[o].timestamp){var l=h(f,a[1],a[0]);l>34*(d[o].timestamp-d[o-1].timestamp)/1e3?i.set("lineDash",!0):i.set("lineDash",!1)}k.addFeature(i);var s=e.proj.transform(d[o-1].coord,f,m),c=new e.geom.Point(s),u=new e.Feature(c);u.set("type","node"),u.set("featureInfo",{type:"trackNode",data:{coord:s,projection:m,overLabel:d[o-1].overLabel||"",clickLabel:d[o-1].clickLabel||"",keepOneOverlayVisible:!0}}),u.set("finished","play"!=t.status);var p=d[o-1].direction?parseFloat(d[o-1].direction)/180*Math.PI:0;u.set("rotation",p),k.addFeature(u),y.push(o)}}t.$on("$destroy",function(){t.markerEnd=0,s&&a.cancel(s),t.$emit("openlayers.map.trackIndex",t.markerEnd),e.Observable.unByKey(c),r.removeLayer(L)});var v=o.getDefaults(u),m=v.view.projection,h=(n.isDefined,n.getGreatCircleDistance),w=n.createStyle;t.markerEnd=0;var S={route:w(i.routeProperties&&JSON.parse(i.routeProperties).style||i.lineProperties&&JSON.parse(i.lineProperties).style||v.styles.path),line:w(i.lineProperties&&JSON.parse(i.lineProperties).style||v.styles.path),geoMarker:"",node:i.pointProperties&&JSON.parse(i.pointProperties).style},b=new Image;b.src=t.carTrack.car.style.image.icon.img,t.carTrack.car.style.image.icon.img=b,S.geoMarker=w(t.carTrack.car.style),S.node.image.icon&&(S.node.image.icon.img=b,S.node=w(S.node));var k=new e.source.Vector,L=new e.layer.Vector({source:k,style:function(e,t){if(e.get("finished")){e.get("rotation")&&S[e.get("type")].getImage().setRotation(e.get("rotation")),e.get("lineDash")&&S.line.getStroke().setLineDash([4,10]);var o=r.getView().getZoomForResolution(t);return o<14?S.node.getImage().setOpacity(0):S.node.getImage().setOpacity(1),S[e.get("type")]}return null}});r.addLayer(L);var O=new e.geom.Point(d[t.markerEnd].coord);O=O.transform(f,m);var x=new e.Feature(O);x.set("type","geoMarker"),k.addFeature(x),c=r.on("postcompose",function(o){var a=o.vectorContext;if("pause"!=t.status){if(t.showRoute)for(var n=1;n<d.length;n++){var i=[d[n-1].coord,d[n].coord],l=new e.geom.LineString(i);l=l.transform(f,m);var s=new e.Feature(l);a.drawFeature(s,S.route),s.set("type","route"),k.addFeature(s)}if(t.markerEnd>=1){for(var n=1;n<=t.markerEnd;n++){var i=[d[n-1].coord,d[n].coord];if(d[n].timestamp){var c=h(f,i[1],i[0]);c>34*(d[n].timestamp-d[n-1].timestamp)/1e3?S.line.getStroke().setLineDash([4,10]):S.line.getStroke().getLineDash()&&S.line.getStroke().setLineDash(void 0)}var u=new e.geom.LineString(i);u=u.transform(f,m);var g=new e.Feature(u);a.drawFeature(g,S.line)}for(var n=0;n<t.markerEnd;n++){var y=new e.geom.Point(d[n].coord);y=y.transform(f,m);var v=new e.Feature(y);if(S.node&&S.node.getImage()&&void 0!=S.node.getImage().getRotation()){var w=d[n].direction?parseFloat(d[n].direction)/180*Math.PI:0;S.node.getImage().setRotation(w),r.getView().getZoom()<14?S.node.getImage().setOpacity(0):S.node.getImage().setOpacity(1)}a.drawFeature(v,S.node)}}if(t.markerEnd>=0){var b=new e.geom.Point(d[t.markerEnd].coord);b=b.transform(f,m);var L=new e.Feature(b);if(S.geoMarker&&S.geoMarker.getImage()&&void 0!=S.geoMarker.getImage().getRotation()){var w=d[t.markerEnd].direction?parseFloat(d[t.markerEnd].direction)/180*Math.PI:0;S.geoMarker.getImage().setRotation(w)}a.drawFeature(L,S.geoMarker);var O;O="pixel"===f?d[t.markerEnd].coord:e.proj.transform(d[t.markerEnd].coord,f,m);var x=r.getView();if(p)x.setCenter(O);else{var F=r.getSize(),C=x.calculateExtent(F);e.extent.containsCoordinate(C,O)||x.setCenter(O)}}r.render()}}),t.$watch("status",function(e,r){"play"==e?s=a(function(){t.markerEnd>=d.length-1?a.cancel(s):t.markerEnd++,k.getFeatures().forEach(function(e){e.set("finished",!1)})},t.interval):"pause"==e?(s&&a.cancel(s),k.getFeatures().forEach(function(e){e.set("finished",!0)})):"stop"==e&&(s&&a.cancel(s),t.markerEnd=0,y=[],k.getFeatures().forEach(function(e){"geoMarker"!=e.get("type")&&k.removeFeature(e)}))}),t.$watch("go",function(e,r){angular.isDefined(e)&&(t.markerEnd=e)}),t.$watch("interval",function(e,r){"play"==t.status&&(s&&a.cancel(s),s=a(function(){t.markerEnd>=d.length-1?a.cancel(s):t.markerEnd++},e))}),t.$watch("markerEnd",function(r){t.$emit("openlayers.map.trackIndex",r),l(r),O.setCoordinates(e.proj.transform(d[r].coord,f,m));var o=d[r].direction?parseFloat(d[r].direction)/180*Math.PI:0;x.set("rotation",o)})})}}}]),angular.module("openlayers-directive").directive("olView",["$log","$q","olData","olMapDefaults","olHelpers",function(t,r,o,a,n){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(t,r,o,i){var l=i.getOpenlayersScope(),s=n.isNumber,c=n.safeApply,u=n.createView;l.getMap().then(function(t){var r=a.getDefaults(l),o=l.view;o.projection||(o.projection=r.view.projection),o.maxZoom||(o.maxZoom=r.view.maxZoom),o.minZoom||(o.minZoom=r.view.minZoom),o.rotation||(o.rotation=r.view.rotation);var n=u(o);t.setView(n),l.$watchCollection("view",function(e){s(e.rotation)&&n.setRotation(e.rotation)});var i=n.on("change:rotation",function(){c(l,function(e){e.view.rotation=t.getView().getRotation()})});l.$on("$destroy",function(){e.Observable.unByKey(i)})})}}}]),angular.module("openlayers-directive").service("olData",["$log","$q",function(e,t){function r(t,r){var o,a;if(angular.isDefined(r))o=r;else if(1===Object.keys(t).length)for(a in t)t.hasOwnProperty(a)&&(o=a);else 0===Object.keys(t).length?o="main":e.error("[AngularJS - Openlayers] - You have more than 1 map on the DOM, you must provide the map ID to the olData.getXXX call");return o}var o={},a=function(e,t){var o=r(e,t);e[o].resolvedDefer=!0},n=function(e,o){var a,n=r(e,o);return angular.isDefined(e[n])&&e[n].resolvedDefer!==!0?a=e[n].defer:(a=t.defer(),e[n]={defer:a,resolvedDefer:!1}),a},i=function(e,t){var o,a=r(e,t);return o=angular.isDefined(e[a])&&e[a].resolvedDefer!==!1?e[a].defer:n(e,t)};this.setMap=function(e,t){var r=n(o,t);r.resolve(e),a(o,t)},this.getMap=function(e){var t=i(o,e);return t.promise},this.resetMap=function(e){angular.isDefined(o[e])&&delete o[e]}}]),angular.module("openlayers-directive").factory("olHelpers",["$q","$log","$http","$compile",function(t,r,o,a){function n(e){for(var t in e)if("_"==t[t.length-1]){var r=t.substr(0,t.length-1);e[r]=angular.copy(e[t]),delete e[t]}for(var t in e)e[t]?e[t]instanceof Object&&arguments.callee(e[t]):delete e[t]}function i(e){return e*L/180}function l(t,r,o){var r=e.proj.transform(r,t,"EPSG:4326"),o=e.proj.transform(o,t,"EPSG:4326"),a=r[0],n=r[1],l=o[0],s=o[1],c=i(a),u=i(l),p=c-u,d=i(n)-i(s),g=2*Math.asin(Math.sqrt(Math.pow(Math.sin(p/2),2)+Math.cos(c)*Math.cos(u)*Math.pow(Math.sin(d/2),2)));return g*=k,g=Math.round(1e4*g)/1e4}function s(t,r,o){var r=e.proj.transform(r,t,"EPSG:4326"),o=e.proj.transform(o,t,"EPSG:4326"),a=new e.Sphere(6378137),n=a.haversineDistance(r,o);return n}var c,u,p=function(e){return angular.isDefined(e)},d=function(e){return angular.isDefined(e)&&null!==e},g=function(e){if(e instanceof Array)return e.join(",");var t=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,e=e.toLowerCase();if(e&&t.test(e)){if(4===e.length){for(var r="#",o=1;o<4;o+=1)r+=e.slice(o,o+1).concat(e.slice(o,o+1));e=r}for(var a=[],o=1;o<7;o+=2)a.push(parseInt("0x"+e.slice(o,o+2)));return a.join(",")}if(e&&e.indexOf("rgb")!=-1){var n=e.split("(")[1];return n=n.slice(0,n.length-1),e=n}return null},f=function(t,r,o,a){if(r){w(t,null,"clickLabel");var n,i,l=r.get("featureInfo");if(l&&(n=l.type,i=l.data),r.get("features")&&(n="clusterFeature"),"marker"===n){var s=i;if(s.ngClick&&("click"===a.type||"singleclick"===a.type||"touchend"===a.type)){var p=s.ngClick;return p.triggerHandler("click"),a.preventDefault(),void a.stopPropagation()}s.clickLabel&&(s.clickLabel.title||s.clickLabel.message||s.clickLabel.url)&&O(r,t,s,o.$parent)}else if("clusterFeature"===n){var d=r.get("features"),g=d.length;if(1==g){var f=d[0],s=f.get("featureInfo").data;if(s.ngClick&&("click"===a.type||"singleclick"===a.type||"touchend"===a.type)){var p=s.ngClick;return p.triggerHandler("click"),a.preventDefault(),void a.stopPropagation()}s.clickLabel&&(s.clickLabel.title||s.clickLabel.message||s.clickLabel.url)&&O(f,t,s,o.$parent)}else{var y=r.get("multiFeatureEvent");if(!y||y.indexOf("over")==-1){var v=r.get("overLay");v&&v.getMap()&&v.get("overLabel")&&(v.unset("overLabel"),v.set("clickLabel","true"));var m=t.getView();c&&e.Observable.unByKey(c),c=m.on("change:resolution",function(){w(t,null,"clickLabel")})}}}else if("esriFeature"===n){var h=r.getStyle(),S=r.clone(),b=D({fill:{color:[255,0,0,.1]},stroke:{color:"#f00",width:1},zIndex:9});h&&S.setStyle(null),u&&u.setMap(null),u=new e.layer.Vector({source:new e.source.Vector}),u.setMap(t),u.setStyle(b),u.getSource().addFeature(S)}}else w(t,null,"clickLabel")},y=function(t,r,o){var a=t.getView().getProjection().getCode();if(r){w(t,null,"overLabel");var n,i,l=r.get("featureInfo");if(l&&(n=l.type,i=l.data),r.get("features")&&(n="clusterFeature"),"marker"===n){var s=i;s.overLabel&&(s.overLabel.title||s.overLabel.message||s.overLabel.url)&&x(r,t,s,o.$parent)}else if("clusterFeature"===n){var c=r.get("features"),p=c.length;if(1==p){var d=c[0],s=d.get("featureInfo").data;s.overLabel&&(s.overLabel.title||s.overLabel.message||s.overLabel.url)&&x(d,t,s,o.$parent)}else{var g=r.get("multiFeatureEvent ");if(!g||g.indexOf("over")==-1){if(r.get("overLay")&&r.get("overLay").getMap()&&r.get("overLay").get("clickLabel"))return;for(var s=angular.copy(c[0].get("featureInfo").data),f="<ul class='featureList'>",y=0;y<p;y++){var v=c[y].get("id"),m=c[y].get("name");m||(m="空");var s=angular.copy(c[y].get("featureInfo").data),h=e.proj.transform(s.coord,s.projection,a).join(",");f+="<li ng-click='locateFeature(\""+v+'","'+h+"\")'>"+m+"</li>"}f+="</ul>",s.overLabel={classNm:"clusterOver",title:"",placement:"right",message:f,id:""},x(r,t,s,o)}}}else if("esriFeature"===n){var S=r.getStyle(),b=r.clone(),k={fill:{color:[255,0,0,.1]},stroke:{color:"#f00",width:1},zIndex:9};r.get("moveStyle")&&(k=r.get("moveStyle")),S&&b.setStyle(null),u&&t.removeLayer(u),u=new e.layer.Vector({source:new e.source.Vector}),t.addLayer(u),u.setStyle(D(k)),u.getSource().addFeature(b)}}else w(t,null,"overLabel"),u&&t.removeLayer(u)},v=function(t,r,o){t.on(r,function(a){var n=a.coordinate,i=t.getView().getProjection().getCode();"pixel"===i&&(n=n.map(function(e){return parseInt(e,10)}));var l="";if("singleclick"==r)l=t.forEachFeatureAtPixel(a.pixel,function(e){return e}),f(t,l,o,a);else if("pointermove"==r){var s=t.getEventPixel(a.originalEvent);l=t.forEachFeatureAtPixel(s,function(e){return e}),o.locateFeature=function(r,a){w(t,null,"clickLabel"),c&&e.Observable.unByKey(c);var n=[];n=a.split(",").map(function(e){return+e});var i=t.getView(),l=t.getView().getZoom(),s=l<18?18:l+2;i.animate({center:n},{zoom:s},function(){t.getLayers().forEach(function(e){if(e.get("cluster"))for(var a=e.getSource().getFeatures(),n=a.length,i=0;i<n;i++){var l=a[i].get("features");l.forEach(function(e){if(e.get("id")==r)return O(e,t,e.get("featureInfo").data,o.$parent),!1})}})})},y(t,l,o)}l=l?l:"",o.$emit("openlayers.map."+r,{coord:n,projection:i,event:a,feature:l})})},m=function(t,r,o){var a=e.proj.transform(t,r,o);return a},h=function(t,r,o,a){t.css("display","block");var n=new e.Overlay({id:o,position:r,element:t[0],positioning:"top-left",insertFirst:!1,stopEvent:void 0==a||a});return n},w=function(e,t,r){var o=e.getOverlays(),a=o.getLength();if(t||r)if(t)for(var n=a-1;n>=0;n--)o.item(n).getId()==t&&o.removeAt(n);else for(var n=a-1;n>=0;n--)o.item(n).get(r)&&o.removeAt(n);else o.clear()},S=function(e){var r=t.defer();return e.getLayers().forEach(function(t){if(t.get("plotLayer")){var o=[],a=t.getSource().getFeatures();a.forEach(function(t){var r=t.get("plotType"),a=JSON.parse(JSON.stringify(t.getStyle()));if(n(a),"text"==r.bigClass)var i=t.get("plotLay").split("&"),l=e.getOverlayById(i[0]),s={plotType:r,text:$(l.getElement()).find("textarea").val(),textType:i[1],style:a,coords:t.getGeometry().points};else if("icon"==r.bigClass)var s={plotType:r,style:{image:{icon:{anchor:[.5,1],color:t.getStyle().getImage().getColor(),src:t.getStyle().getImage().getSrc()}}},coords:t.getGeometry().points};else var s={plotType:r,style:a,coords:t.getGeometry().points};JSON.stringify(s);o.push(s)}),r.resolve(JSON.stringify(o))}}),r.promise},b=function(e){e.once("postcompose",function(e){var t=e.context.canvas;navigator.msSaveBlob?navigator.msSaveBlob(t.msToBlob(),"map.png"):t.toBlob(function(e){saveAs(e,"map.png")})}),e.renderSync()},k=6378137,L=Math.PI,O=function(e,t,r,o){r.keepOneOverlayVisible&&w(t,null,"clickLabel");var a=angular.copy(r);if(a.label=angular.copy(r.clickLabel),o.selectedLayid=a.label.id,a.label.url)$.get(a.label.url,function(r){a.label.message=r;var n=F(e,t,a,o);n.set("clickLabel","true")});else{var n=F(e,t,a,o);n.set("clickLabel","true")}},x=function(e,t,r,o){w(t,null,"overLabel");var a=angular.copy(r);if(a.label=angular.copy(r.overLabel),a.label.classNm="featureOver "+a.label.classNm,a.label.url)$.get(a.label.url,function(r){a.label.message=r;var n=F(e,t,a,o);n.set("overLabel","true")});else{var n=F(e,t,a,o);n.set("overLabel","true")}},F=function(t,r,o,n){var i,l=r.getView().getProjection().getCode();if(o.coord&&2==o.coord.length?i=e.proj.transform(o.coord,o.projection,l):o.lon&&o.lat&&(i=e.proj.transform([o.lon,o.lat],o.projection,l)),o.label&&o.label.message){o.label.placement||(o.label.placement="top");var s="<div class='popover "+o.label.placement+"' style='display:block;background-color: white;'>";s+="top"==o.label.placement?"<div class='arrow' style='left:50%;'></div>":"<div class='arrow'></div>",o.label.title&&(s+="<h3 class='popover-title'>"+o.label.title+"</h3>"),s+="<div class='popover-content'>"+o.label.message+"</div>";var c=$('<div class="'+o.label.classNm+'"></div>'),u=a(s)(n);angular.element(c).html(u),t&&n.$apply();var p=h(c,i,o.label.id,o.label.stopEvent);return r.addOverlay(p),t&&t.set("overLay",p),p}},C=["Road","Aerial","AerialWithLabels","collinsBart","ordnanceSurvey"],j=function(){return{attribution:e.control.Attribution,fullscreen:e.control.FullScreen,mouseposition:e.control.MousePosition,overviewmap:e.control.OverviewMap,rotate:e.control.Rotate,scaleline:e.control.ScaleLine,zoom:e.control.Zoom,zoomslider:e.control.ZoomSlider,zoomtoextent:e.control.ZoomToExtent}},E=function(){return{dragZoom:e.interaction.DragZoom,draw:e.interaction.Draw,select:e.interaction.Select,modify:e.interaction.Modify}},M=["osm","sat","hyb"],P=["World_Imagery","World_Street_Map","World_Topo_Map","World_Physical_Map","World_Terrain_Base","Ocean_Basemap","NatGeo_World_Map"],I={style:e.style.Style,fill:e.style.Fill,stroke:e.style.Stroke,circle:e.style.Circle,icon:e.style.Icon,image:e.style.Image,regularshape:e.style.RegularShape,text:e.style.Text,atlasManager:e.style.AtlasManager},T=function(e,t){return t&&e instanceof t?e:t?new t(e):e},D=function e(t,r){var o;if(r?o=t[r]:(r="style",o=t),"style"===r&&t instanceof Function)return t;if(!(o instanceof Object))return o;var a;if("[object Object]"===Object.prototype.toString.call(o)){a={};var n=I[r];if(n&&o instanceof n)return o;Object.getOwnPropertyNames(o).forEach(function(t,i,l){var s=I[t];return n&&s&&s.prototype instanceof I[r]?(console.assert(1===l.length,"Extra parameters for "+r),a=e(o,t),T(a,s)):(a[t]=e(o,t),void("text"!==t&&"string"!=typeof a[t]&&(a[t]=T(a[t],I[t]))))})}else a=o;return T(a,I[r])},V=function(e){if(e.type)return e.type;switch(e.source.type){case"ImageWMS":return"Image";case"ImageStatic":case"ImageArcGISRest":return"Image";case"GeoJSON":case"JSONP":case"TopoJSON":case"KML":case"WKT":case"EsriJson":return"Vector";case"TileVector":return"TileVector";case"Raster":return"Image";default:return"Tile"}},A=function(t){var o;switch(t.projection){case"pixel":if(!p(t.extent))return void r.error("[AngularJS - Openlayers] - You must provide the extent of the image if using pixel projection");o=new e.proj.Projection({code:"pixel",units:"pixels",extent:t.extent});break;default:o=new e.proj.get(t.projection)}return o},N=function(e){return["watercolor","terrain","toner"].indexOf(e)!==-1},G=function(t,a,n){var i,l,s=new e.format.GeoJSON;switch(t.type){case"MapBox":if(!t.mapId||!t.accessToken)return void r.error("[AngularJS - Openlayers] - MapBox layer requires the map id and the access token");l="http://api.tiles.mapbox.com/v4/"+t.mapId+"/{z}/{x}/{y}.png?access_token="+t.accessToken;var c=window.devicePixelRatio;c>1&&(l=l.replace(".png","@2x.png")),i=new e.source.XYZ({url:l,tileLoadFunction:t.tileLoadFunction,attributions:J(t),tilePixelRatio:c>1?2:1});break;case"MapBoxStudio":if(!t.mapId||!t.accessToken||!t.userId)return void r.error("[AngularJS - Openlayers] - MapBox Studio layer requires the map id, user id  and the access token");l="https://api.mapbox.com/styles/v1/"+t.userId+"/"+t.mapId+"/tiles/{z}/{x}/{y}?access_token="+t.accessToken,i=new e.source.XYZ({url:l,tileLoadFunction:t.tileLoadFunction,attributions:J(t),tileSize:t.tileSize||[512,512]});break;case"ImageWMS":t.url&&t.params||r.error("[AngularJS - Openlayers] - ImageWMS Layer needs valid server url and params properties"),i=new e.source.ImageWMS({url:t.url,imageLoadFunction:t.imageLoadFunction,attributions:J(t),crossOrigin:"undefined"==typeof t.crossOrigin?"anonymous":t.crossOrigin,params:R(t.params),ratio:t.ratio});break;case"TileWMS":(t.url||t.urls)&&t.params||r.error("[AngularJS - Openlayers] - TileWMS Layer needs valid url (or urls) and params properties");var u={tileLoadFunction:t.tileLoadFunction,crossOrigin:"undefined"==typeof t.crossOrigin?"anonymous":t.crossOrigin,params:R(t.params),attributions:J(t)};t.serverType&&(u.serverType=t.serverType),t.url&&(u.url=t.url),t.urls&&(u.urls=t.urls),i=new e.source.TileWMS(u);break;case"WMTS":(t.url||t.urls)&&t.tileGrid||r.error("[AngularJS - Openlayers] - WMTS Layer needs valid url (or urls) and tileGrid properties");var d={tileLoadFunction:t.tileLoadFunction,projection:a,layer:t.layer,attributions:J(t),matrixSet:"undefined"===t.matrixSet?a:t.matrixSet,format:"undefined"===t.format?"image/jpeg":t.format,requestEncoding:"undefined"===t.requestEncoding?"KVP":t.requestEncoding,tileGrid:new e.tilegrid.WMTS({origin:t.tileGrid.origin,resolutions:t.tileGrid.resolutions,matrixIds:t.tileGrid.matrixIds}),style:"undefined"===t.style?"normal":t.style};p(t.url)&&(d.url=t.url),p(t.urls)&&(d.urls=t.urls),i=new e.source.WMTS(d);break;case"OSM":i=new e.source.OSM({tileLoadFunction:t.tileLoadFunction,attributions:J(t)}),t.url&&i.setUrl(t.url);break;case"BingMaps":if(!t.key)return void r.error("[AngularJS - Openlayers] - You need an API key to show the Bing Maps.");var g={key:t.key,tileLoadFunction:t.tileLoadFunction,attributions:J(t),imagerySet:t.imagerySet?t.imagerySet:C[0],culture:t.culture};t.maxZoom&&(g.maxZoom=t.maxZoom),i=new e.source.BingMaps(g);break;case"MapQuest":if(!t.layer||M.indexOf(t.layer)===-1)return void r.error("[AngularJS - Openlayers] - MapQuest layers needs a valid 'layer' property.");i=new e.source.MapQuest({attributions:J(t),layer:t.layer});break;case"EsriBaseMaps":if(!t.layer||P.indexOf(t.layer)===-1)return void r.error("[AngularJS - Openlayers] - ESRI layers needs a valid 'layer' property.");var f="http://services.arcgisonline.com/ArcGIS/rest/services/",y=f+t.layer+"/MapServer/tile/{z}/{y}/{x}";i=new e.source.XYZ({attributions:J(t),tileLoadFunction:t.tileLoadFunction,url:y});break;case"TileArcGISRest":t.url||r.error("[AngularJS - Openlayers] - TileArcGISRest Layer needs valid url"),i=new e.source.TileArcGISRest({attributions:J(t),tileLoadFunction:t.tileLoadFunction,url:t.url});break;case"GeoJSON":if(!t.geojson&&!t.url)return void r.error("[AngularJS - Openlayers] - You need a geojson property to add a GeoJSON layer.");if(p(t.url))i=new e.source.Vector({format:new e.format.GeoJSON,url:t.url,strategy:t.strategy||e.loadingstrategy.all});else{i=new e.source.Vector;var v,m=a;v=p(t.geojson.projection)?new e.proj.get(t.geojson.projection):a;var h=s.readFeatures(t.geojson.object,{featureProjection:m.getCode(),dataProjection:v.getCode()});i.addFeatures(h)}n&&n({oSource:i});break;case"EsriJson":if(!t.url)return void r.error("[AngularJS - Openlayers] - You need a esrijson property to add a EsriJSON layer.");var w=new e.format.EsriJSON;if(!p(t.url)){i=new e.source.Vector;var v,m=a;v=p(t.esrijson.projection)?new e.proj.get(t.esrijson.projection):a;var h=w.readFeatures(t.esrijson.object,{featureProjection:m.getCode(),dataProjection:v.getCode()});return void i.addFeatures(h)}i=new e.source.Vector({loader:function(r,o,a){var l=t.url;$.ajax({url:l,dataType:"jsonp",success:function(r){if(r.error)alert(r.error.message+"\n"+r.error.details.join("\n"));else{var o=w.readFeatures(r,{featureProjection:a});o.forEach(function(r){if(t.style&&angular.isFunction(t.style)){var o=t.style(r);r.setStyle(o)}if(t.moveStyle&&r.set("moveStyle",t.moveStyle),"random"==t.style){var a={style0:new e.style.Style({stroke:new e.style.Stroke({color:"#FF0000",width:2})}),style1:new e.style.Style({stroke:new e.style.Stroke({color:"#FFFF00",width:2})}),style2:new e.style.Style({stroke:new e.style.Stroke({color:"#00FF00",width:2})}),style3:new e.style.Style({stroke:new e.style.Stroke({color:"#FF7D00",width:2})}),style4:new e.style.Style({stroke:new e.style.Stroke({color:"green",width:2})})},n=Math.random();n<.1?r.setStyle(a.style0):n<.3?r.setStyle(a.style1):r.setStyle(a.style2)}r.set("featureInfo",{type:"esriFeature",data:r})}),o.length>0&&(i.addFeatures(o),n&&n({oSource:i}))}}})}});break;case"WKT":if(!t.wkt&&!t.wkt.data)return void r.error("[AngularJS - Openlayers] - You need a WKT property to add a WKT format vector layer.");i=new e.source.Vector;var S,b=new e.format.WKT;S=p(t.wkt.projection)?new e.proj.get(t.wkt.projection):a;var k=b.readFeatures(t.wkt.data,{featureProjection:a.getCode(),dataProjection:S.getCode()});i.addFeatures(k);break;case"JSONP":if(!t.url)return void r.error("[AngularJS - Openlayers] - You need an url properly configured to add a JSONP layer.");p(t.url)&&(i=new e.source.ServerVector({format:s,loader:function(){var e=t.url+"&outputFormat=text/javascript&format_options=callback:JSON_CALLBACK";o.jsonp(e,{cache:t.cache}).success(function(e){i.addFeatures(s.readFeatures(e))}).error(function(e){r(e)})},projection:a}));break;case"TopoJSON":if(!t.topojson&&!t.url)return void r.error("[AngularJS - Openlayers] - You need a topojson property to add a TopoJSON layer.");i=t.url?new e.source.Vector({format:new e.format.TopoJSON,url:t.url}):new e.source.Vector(angular.extend(t.topojson,{format:new e.format.TopoJSON}));break;case"TileJSON":i=new e.source.TileJSON({url:t.url,attributions:J(t),tileLoadFunction:t.tileLoadFunction,crossOrigin:"anonymous"});break;case"TileVector":t.url&&t.format||r.error("[AngularJS - Openlayers] - TileVector Layer needs valid url and format properties"),i=new e.source.VectorTile({url:t.url,projection:a,attributions:J(t),tileLoadFunction:t.tileLoadFunction,format:new e.format[t.format],tileGrid:new e.tilegrid.createXYZ({maxZoom:t.maxZoom||19})});break;case"TileTMS":t.url&&t.tileGrid||r.error("[AngularJS - Openlayers] - TileTMS Layer needs valid url and tileGrid properties"),
i=new e.source.TileImage({url:t.url,maxExtent:t.maxExtent,attributions:J(t),tileLoadFunction:t.tileLoadFunction,tileGrid:new e.tilegrid.TileGrid({origin:t.tileGrid.origin,resolutions:t.tileGrid.resolutions}),tileUrlFunction:function(e){var r=e[0],o=e[1],a=e[2];if(o<0||a<0)return"";var n=t.url+r+"/"+o+"/"+a+".png";return n}});break;case"TileImage":i=new e.source.TileImage({url:t.url,attributions:J(t),tileLoadFunction:t.tileLoadFunction,tileGrid:new e.tilegrid.TileGrid({origin:t.tileGrid.origin,resolutions:t.tileGrid.resolutions}),tileUrlFunction:function(e){var r=e[0],o=e[1],a=-e[2]-1,n=t.url.replace("{z}",r.toString()).replace("{x}",o.toString()).replace("{y}",a.toString());return n}});break;case"bdTileImage":for(var L=[],O=0;O<16;O++)L[O]=Math.pow(2,18-O);var x=new e.tilegrid.TileGrid({origin:[0,0],resolutions:L});i=new e.source.TileImage({url:t.url,attributions:J(t),tileLoadFunction:t.tileLoadFunction,tileGrid:x,tileUrlFunction:function(e){if(!e)return"";var r=e[0],o=e[1],a=e[2];o<0&&(o=-o),a<0&&(a=-a);var n=t.url+r+"/"+o/10+" / "+a/10+" / "+o+" - "+a+".png ";return n}});break;case"KML":var F=t.extractStyles||!1;i=new e.source.Vector({url:t.url,format:new e.format.KML,radius:t.radius,extractStyles:F});break;case"Stamen":if(!t.layer||!N(t.layer))return void r.error("[AngularJS - Openlayers] - You need a valid Stamen layer.");i=new e.source.Stamen({tileLoadFunction:t.tileLoadFunction,layer:t.layer});break;case"ImageStatic":if(!t.url||!angular.isArray(t.imageSize)||2!==t.imageSize.length)return void r.error("[AngularJS - Openlayers] - You need a image URL to create a ImageStatic layer.");i=new e.source.ImageStatic({url:t.url,attributions:J(t),imageSize:t.imageSize,projection:a,imageExtent:t.imageExtent?t.imageExtent:a.getExtent(),imageLoadFunction:t.imageLoadFunction});break;case"XYZ":t.url||t.tileUrlFunction||r.error("[AngularJS - Openlayers] - XYZ Layer needs valid url or tileUrlFunction properties"),i=new e.source.XYZ({url:t.url,attributions:J(t),minZoom:t.minZoom,maxZoom:t.maxZoom,projection:t.projection,tileUrlFunction:t.tileUrlFunction,tileLoadFunction:t.tileLoadFunction});break;case"Zoomify":t.url&&angular.isArray(t.imageSize)&&2===t.imageSize.length||r.error("[AngularJS - Openlayers] - Zoomify Layer needs valid url and imageSize properties"),i=new e.source.Zoomify({url:t.url,size:t.imageSize})}return i||r.warn('[AngularJS - Openlayers] - No source could be found for type "'+t.type+'"'),i},R=function(e){var t=e;if(e&&"object"==typeof e){t="[object Array]"===Object.prototype.toString.call(e)?[]:{};for(var r in e)t[r]=R(e[r])}return t},J=function(t){var r=[];return p(t.attribution)&&r.unshift(new e.Attribution({html:t.attribution})),r},z=function(t){var r=new e.layer.Group;return r.set("name",t),r},q=function(t,r){var o;return angular.forEach(t,function(t){if(t instanceof e.layer.Group&&t.get("name")===r)return void(o=t)}),o},Z=function(e,t){for(var r,o=0;o<e.getLength();o++){var a=e.item(o);if(a.get("markers")){r=o;break}}if(p(r)){var n=e.item(r);t.index=r,e.setAt(r,t),n.index=e.getLength(),e.push(n)}else t.index=e.getLength(),e.push(t)},B=function(e,t){e.forEach(function(r,o){if(r.index===t)return void e.removeAt(o)})};return{isDefined:p,isNumber:function(e){return angular.isNumber(e)},createView:function(t){var r=A(t),o={projection:r,maxZoom:t.maxZoom,minZoom:t.minZoom};return t.center&&(o.center=t.center),t.extent&&(o.extent=t.extent),t.zoom&&(o.zoom=t.zoom),t.resolutions&&(o.resolutions=t.resolutions),new e.View(o)},isDefinedAndNotNull:d,colorRgb:g,mapUnByKey:function(t){e.Observable.unByKey(t)},getPlotData:S,exportMap:b,isString:function(e){return angular.isString(e)},isArray:function(e){return angular.isArray(e)},isObject:function(e){return angular.isObject(e)},equals:function(e,t){return angular.equals(e,t)},isValidCenter:function(e){return angular.isDefined(e)&&("boolean"==typeof e.autodiscover||angular.isNumber(e.lat)&&angular.isNumber(e.lon)||angular.isArray(e.coord)&&2===e.coord.length&&angular.isNumber(e.coord[0])&&angular.isNumber(e.coord[1])||angular.isArray(e.bounds)&&4===e.bounds.length&&angular.isNumber(e.bounds[0])&&angular.isNumber(e.bounds[1])&&angular.isNumber(e.bounds[1])&&angular.isNumber(e.bounds[2]))},safeApply:function(e,t){var r=e.$root.$$phase;"$apply"===r||"$digest"===r?e.$eval(t):e.$apply(t)},isSameCenterOnMap:function(t,r){var o=t.projection||"EPSG:4326",a=[t.lon,t.lat],n=r.getView().getProjection(),i=e.proj.transform(r.getView().getCenter(),n,o),l=r.getView().getZoom();return i[1].toFixed(4)===a[1].toFixed(4)&&i[0].toFixed(4)===a[0].toFixed(4)&&l===t.zoom},setCenter:function(t,r,o,a){var n=[o.lon,o.lat],i=e.proj.transform(n,o.projection,r);o.projection===r?a&&t.getCenter()?t.animate({center:n,duration:150}):t.setCenter(n):a&&t.getCenter()?t.animate({center:i,duration:150}):t.setCenter(i)},setZoom:function(e,t,r){e.animate({zoom:t,duration:150})},isBoolean:function(e){return"boolean"==typeof e},createStyle:D,setMapEvents:function(e,t,r){if(p(e)&&angular.isArray(e.map))for(var o in e.map){var a=e.map[o];v(t,a,r)}},getGreatCircleDistance:l,getGeodesicDistance:s,setClickMarker:O,setOverMarker:x,setMarkerEvent:F,coordinateTransform:m,setVectorLayerEvents:function(e,t,r,o){p(e)&&angular.isArray(e.layers)&&angular.forEach(e.layers,function(e){angular.element(t.getViewport()).on(e,function(a){var n=t.getEventPixel(a),i=t.forEachFeatureAtPixel(n,function(e,t){return d(t)&&t.get("name")===o?e:null});d(i)&&r.$emit("openlayers.layers."+o+"."+e,i,a)})})},setViewEvents:function(e,t,r){if(p(e)&&angular.isArray(e.view)){var o=t.getView();angular.forEach(e.view,function(e){o.on(e,function(t){r.$emit("openlayers.view."+e,o,t)})})}},detectLayerType:V,createLayer:function(t,r,o,a){var n,i=V(t);"function"!=typeof o||a||(a=o,o=void 0);var l=G(t.source,r,a);if(l){"Vector"===i&&t.clustering&&(l=new e.source.Cluster({source:l,distance:t.clusteringDistance}));var s={source:l};switch(d(t.opacity)&&(s.opacity=t.opacity),d(t.visible)&&(s.visible=t.visible),d(t.extent)&&(s.extent=t.extent),d(t.zIndex)&&(s.zIndex=t.zIndex),d(t.minResolution)&&(s.minResolution=t.minResolution),d(t.maxResolution)&&(s.maxResolution=t.maxResolution),d(t.updateWhileAnimating)&&(s.updateWhileAnimating=t.updateWhileAnimating),d(t.updateWhileInteracting)&&(s.updateWhileInteracting=t.updateWhileInteracting),i){case"Image":n=new e.layer.Image(s);break;case"Tile":n=new e.layer.Tile(s);break;case"Heatmap":n=new e.layer.Heatmap(s);break;case"Vector":n=new e.layer.Vector(s);break;case"TileVector":n=new e.layer.VectorTile(s)}if(p(o)?n.set("name",o):p(t.name)&&n.set("name",t.name),p(t.customAttributes))for(var c in t.customAttributes)n.set(c,t.customAttributes[c]);return a&&a({oLayer:n}),n}},createVectorLayer:function(){return new e.layer.Vector({source:new e.source.Vector,zIndex:arguments[0]||0})},createClusterLayer:function(){return new e.layer.Vector({source:new e.source.Cluster({distance:parseInt(arguments[1]||20),source:new e.source.Vector}),zIndex:arguments[0]||0})},notifyCenterUrlHashChanged:function(e,t,r){if(t.centerUrlHash){var o=t.lat.toFixed(4)+":"+t.lon.toFixed(4)+":"+t.zoom;p(r.c)&&r.c===o||e.$emit("centerUrlHash",o)}},getControlClasses:j,detectControls:function(e){var t={},r=j();return e.forEach(function(e){for(var o in r)e instanceof r[o]&&(t[o]=e)}),t},getInteractionClasses:E,createFeature:function(t,r){var o;switch(t.type){case"Polygon":o=new e.geom.Polygon(t.coords);break;case"LineString":o=new e.geom.LineString(t.coords);break;case"MultiLineString":o=new e.geom.MultiLineString(t.coords);break;case"Point":o=new e.geom.Point(t.coords);break;case"Circle":o=new e.geom.Circle(t.coords,t.radius);break;default:t.coords?o=new e.geom.Point(t.coords):t.lat&&t.lon&&(o=new e.geom.Point([t.lon,t.lat]))}p(t.projection)&&"pixel"!==t.projection&&(o=o.transform(t.projection,r));var a=new e.Feature({id:t.id,name:t.name,geometry:o});if(p(t.style)){if(t.style instanceof Array)for(var n=[],i=t.style.length,l=0;l<i;l++)n[l]=D(t.style[l]);else var n=D(t.style);a.setStyle(n)}return a},addLayerBeforeMarkers:Z,getGroup:q,addLayerToGroup:function(e,t,r){var o=q(e,r);p(o)||(o=z(r),Z(e,o)),t.set("group",r),Z(o.getLayers(),t)},removeLayerFromGroup:function(e,t,r){var o=q(e,r);t.set("group"),B(o.getLayers(),t.index)},removeLayer:B,insertLayer:function(t,r,o){if(t.getLength()<r){for(;t.getLength()<r;){var a=new e.layer.Image;a.index=t.getLength(),t.push(a)}o.index=r,t.push(o)}else{o.index=r,t.insertAt(o.index,o);for(var n=r+1;n<t.getLength();n++){var i=t.item(n);if(null===i){t.removeAt(n);break}i.index=n}}},createOverlay:h,removeOverlay:w}}]),angular.module("openlayers-directive").factory("olMapDefaults",["$q","olHelpers",function(t,r){var o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",a=function(){return{view:{projection:"EPSG:3857",minZoom:void 0,maxZoom:void 0,rotation:0,extent:void 0},center:{lat:0,lon:0,zoom:1,autodiscover:!1,bounds:[],centerUrlHash:!1,projection:"EPSG:4326"},styles:{path:{fill:{color:"rgba(255,0,0,0.2)"},stroke:{color:"blue",width:4}},marker:{image:new e.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.9,src:o})},feature:{fill:new e.style.Fill({color:"#0099ff"}),stroke:new e.style.Stroke({color:"#1F497D",width:1}),image:new e.style.Circle({radius:7,fill:new e.style.Fill({color:"#0099ff"}),stroke:new e.style.Stroke({color:"#1F497D",width:1})})}},events:{map:[],markers:[],layers:[]},controls:{attribution:!0,rotate:!1,zoom:!0},interactions:{mouseWheelZoom:!1},renderer:"canvas"}},n=r.isDefined,i={};return{getDefaults:function(e){if(!n(e))for(var t in i)return i[t];return i[e.$id]},setDefaults:function(e){var t=e.defaults,r=e.$id,o=a();return n(t)&&(n(t.layers)&&(o.layers=angular.copy(t.layers)),n(t.controls)&&(o.controls=angular.copy(t.controls)),n(t.events)&&(o.events=angular.copy(t.events)),n(t.interactions)&&(o.interactions=angular.copy(t.interactions)),n(t.renderer)&&(o.renderer=t.renderer),n(t.view)&&(o.view.maxZoom=t.view.maxZoom||o.view.maxZoom,o.view.minZoom=t.view.minZoom||o.view.minZoom,o.view.projection=t.view.projection||o.view.projection,o.view.extent=t.view.extent||o.view.extent,o.view.resolutions=t.view.resolutions||o.view.resolutions),n(t.styles)&&(o.styles=angular.extend(o.styles,t.styles)),n(t.loadTilesWhileAnimating)&&(o.loadTilesWhileAnimating=t.loadTilesWhileAnimating),n(t.loadTilesWhileInteracting)&&(o.loadTilesWhileInteracting=t.loadTilesWhileInteracting)),i[r]=o,o}}}])});